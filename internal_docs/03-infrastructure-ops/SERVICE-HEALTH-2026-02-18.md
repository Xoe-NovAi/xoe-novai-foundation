# Service Health Report - 2026-02-18

**Generated By**: OpenCode CLI (GLM-5-free)  
**Date**: 2026-02-18T05:20:00Z  
**Purpose**: Current infrastructure status and remediation plan

---

## Current Status

| Service | Status | Health | Issue |
|---------|--------|--------|-------|
| Consul | Running | ⚠️ Unhealthy | Health check failing |
| MkDocs | Running | ✅ Healthy | Operational |
| Redis | Crashing | ❌ Failed | Permission denied on dump.rdb |
| Qdrant | Crashing | ❌ Failed | Permission denied on snapshots_v2/tmp |
| Vikunja | Crashing | ❌ Failed | Depends on Redis |
| Vikunja DB | Running | ⚠️ Unhealthy | Health check failing |
| Caddy | Running | ⚠️ Unhealthy | Upstream failures |
| Curation Worker | Exited | ❌ Failed | Dependency failure |

---

## Root Cause Analysis

### Redis Permission Issue
```
Error: Fatal error: can't open the RDB file dump.rdb for reading: Permission denied
File: data/redis/dump.rdb
Current Owner: UID 100999
Required Owner: UID 1001 (APP_UID in .env)
```

### Qdrant Permission Issue
```
Error: Failed to remove snapshots temp directory at ./storage/snapshots_v2/tmp: Permission denied
Directory: data/qdrant/snapshots_v2/
Current Owner: UID 100999
Required Owner: UID 1001
```

### Dependency Chain
```
Redis CRASHED → Vikunja can't connect → Caddy upstream failed → Curation Worker exited
```

---

## Remediation Required

### Step 1: Fix Permissions (Requires Sudo)
```bash
# Stop all containers
podman-compose down

# Fix Redis permissions
sudo chown -R 1001:1001 data/redis/
sudo chmod -R 755 data/redis/

# Fix Qdrant permissions
sudo chown -R 1001:1001 data/qdrant/
sudo chmod -R 755 data/qdrant/

# Restart services
podman-compose up -d
```

### Step 2: Verify Services
```bash
# Wait 30 seconds for startup
sleep 30

# Check health
podman ps --format "table {{.Names}}\t{{.Status}}"
curl -s http://localhost:6379/ping  # Redis
curl -s http://localhost:6333/health  # Qdrant
curl -s http://localhost:3456/api/v1/info  # Vikunja
```

### Alternative: Use Fix Script
```bash
sudo ./scripts/fix-permissions.sh
make up
```

---

## Consul Health Check Issue

Consul is running but unhealthy. The health check uses:
```bash
curl -f http://localhost:8500/v1/status/leader
```

The leader is responding (`"10.89.0.78:8300"`), but the container health check may be using a different endpoint or the check interval hasn't passed.

---

## Memory Overcommit Warning

Redis logs show:
```
WARNING Memory overcommit must be enabled!
```

**Fix** (optional, improves stability):
```bash
sudo sysctl vm.overcommit_memory=1
# Add to /etc/sysctl.conf for persistence
echo "vm.overcommit_memory = 1" | sudo tee -a /etc/sysctl.conf
```

---

## Next Actions

1. **Immediate**: Run `sudo ./scripts/fix-permissions.sh`
2. **Then**: `make up` to start services
3. **Verify**: All services healthy
4. **Optional**: Enable memory overcommit

---

## Services That Will Come Online After Fix

| Service | Port | Purpose |
|---------|------|---------|
| Redis | 6379 | Agent Bus state, circuit breakers |
| Qdrant | 6333 | Vector search, semantic memory |
| Vikunja | 3456 | Project management, task tracking |

---

**Status**: BLOCKED - Requires sudo to fix permissions  
**Script Available**: `scripts/fix-permissions.sh`
