# XNAi Phase 5A: zRAM Memory Optimization Kernel Parameters
# Configuration file: /etc/sysctl.d/99-xnai-zram-tuning.conf
# Applied: Phase 5A Task 5A.2
# Kernel versions: 5.10+
# Purpose: Optimize system for aggressive zRAM usage with minimal I/O

# === SWAPPINESS CONFIGURATION ===
# Controls how aggressively the kernel swaps memory pages to swap devices
# For zRAM (in-memory compression), higher values are beneficial vs disk swap
# Default: 60 (balanced)
# Our value: 180 (aggressive, appropriate for fast in-memory zRAM)
# Source: Pop!_OS System76 testing, Fedora optimization (2025-2026)
vm.swappiness = 180

# === PAGE CLUSTER ===
# Controls how many pages are swapped together
# 0 = swap individual pages (suitable for fast zRAM)
# 3 = batch 8 pages (suitable for slow disk I/O)
# Default: 3
# Our value: 0 (single-page for zRAM latency optimization)
vm.page-cluster = 0

# === WATERMARK BOOST FACTOR ===
# Disable the automatic watermark boost that reserves extra memory
# Allows more pages to be available for zRAM swapping
# Default: 15000
# Our value: 0 (disabled)
vm.watermark_boost_factor = 0

# === WATERMARK SCALE FACTOR ===
# Controls memory reclaim aggressiveness at different watermarks
# Higher = more memory kept available for eviction
# Default: 10
# Our value: 125 (4x more aggressive)
vm.watermark_scale_factor = 125

# === VFS CACHE PRESSURE ===
# Controls pressure to reclaim VFS caches vs other memory
# Lower = preserve filesystem cache (recommended)
# Higher = drop cache more aggressively
# Default: 100
# Our value: 50 (preserve cache, half the default pressure)
vm.vfs_cache_pressure = 50

# === DIRTY PAGE WRITEBACK ===
# Controls when dirty pages are written back to disk
# Higher ratio = less frequent writeback, better batching
# Default: 10% background, 20% active
# Our values: 20% background, 40% active (2x default)
vm.dirty_background_ratio = 20
vm.dirty_ratio = 40

# === MEMORY OVERCOMMIT ===
# 0 = estimate available memory (default, recommended)
# 1 = always allow (risky)
# 2 = allow up to overcommit_ratio percent
# Our value: 0 (safe, let kernel estimate)
vm.overcommit_memory = 0
vm.overcommit_ratio = 50

# === OPTIONAL: ADVANCED TUNING ===
# Uncomment if experiencing specific issues

# Zone reclaim mode (NUMA systems)
# 0 = default (reclaim from any zone)
# 1 = local zone reclaim only
# vm.zone_reclaim_mode = 0

# Drop caches manually if needed (requires sysadmin script)
# echo 3 > /proc/sys/vm/drop_caches  # Only in emergencies

# End of Phase 5A zRAM Configuration
