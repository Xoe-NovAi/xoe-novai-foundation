# ============================================================================
# PostgreSQL 16 - Ryzen 5700U Optimization (Containerized)
# ============================================================================
# Target: Vikunja with <200MB footprint
# Hardware: AMD Ryzen 5700U (8 cores, 16GB system max)
# Update: 2026-02-07
# ============================================================================

# ========== MEMORY ==========
shared_buffers = 128MB              # 1/4 system RAM for Vikunja workload
effective_cache_size = 256MB        # Estimate total available cache
work_mem = 8MB                      # Per-operation memory (light sessions)
maintenance_work_mem = 32MB         # VACUUM/CREATE INDEX memory

# ========== CONNECTIONS ==========
max_connections = 20                # Vikunja + monitoring
max_prepared_transactions = 0       # Not used by Vikunja

# ========== WRITE PERFORMANCE ==========
synchronous_commit = off            # Trade durability for throughput (dev/test OK)
wal_level = minimal                 # No streaming replication needed
max_wal_senders = 0                 # No replication
wal_buffers = 4MB
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# ========== QUERY TUNING ==========
random_page_cost = 1.1              # SSD/NVME (Ryzen laptop typical)
effective_io_concurrency = 200      # Ryzen L3 cache optimization
jit = off                           # JIT adds startup overhead (small queries)

# ========== LOGGING ==========
log_min_duration_statement = 1000   # Log slow queries >1s
log_connections = on
log_disconnections = on
log_duration = off

# ========== CRASH RECOVERY ==========
fsync = on                          # Keep enabled (data safety)
full_page_writes = on               # Crash recovery essential

# ========== TEMPORARY ==========
temp_buffers = 8MB
