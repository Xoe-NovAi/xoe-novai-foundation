# ============================================================================
# Xoe-NovAi Phase 1 - Complete Environment Configuration v0.2.0
# ============================================================================
# CRITICAL: This file contains secrets! NEVER commit to git.
# Add to .gitignore: .env .env.local secrets/
# ============================================================================

# ============================================================================
# FOUNDATION STACK CONFIGURATION
# ============================================================================

# Redis Configuration (Foundation)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=changeme123  # ⚠️ CHANGE THIS to a secure value

# LLM Configuration
LLM_MODEL_PATH=/models/Qwen3-0.6B-Q6_K.gguf

# Service Ports
CHAINLIT_PORT=8001
RAG_API_PORT=8000
METRICS_PORT=8002

# Security Settings
CHAINLIT_NO_TELEMETRY=true
APP_UID=1001
APP_GID=1001
UID=1001
GID=1001

# Performance Tuning (Ryzen 5700U - 8 cores)
OPENBLAS_NUM_THREADS=6
OPENBLAS_CORETYPE=ZEN
N_THREADS=6

# Development Settings (disable in production)
DEBUG=false
RELOAD=false
SCARF_NO_ANALYTICS=true

# Phase 2 Feature Flags
PHASE2_QDRANT_ENABLED=false

# ============================================================================
# VIKUNJA CONFIGURATION - ENVIRONMENT VARIABLES (NOT SECRETS)
# ============================================================================
# These variables are used directly, NOT via Podman secrets.
# docker-compose substitutes them at runtime from this .env file.
#
# CRITICAL VARIABLES (must be set before deployment):
#   1. VIKUNJA_DB_PASSWORD - Generate: openssl rand -base64 32
#   2. VIKUNJA_JWT_SECRET - Generate: openssl rand -base64 64
#
# ============================================================================

# === DATABASE CREDENTIALS ===
# ⚠️ IMPORTANT: Generate unique passwords!
#
# Generate DB password:
#   VIKUNJA_DB_PASSWORD=$(openssl rand -base64 32)
#
# Generate JWT secret:
#   VIKUNJA_JWT_SECRET=$(openssl rand -base64 64)
#
# Add both to this file below:

VIKUNJA_DB_PASSWORD=CHANGE_ME_DATABASE_PASSWORD_HERE
VIKUNJA_JWT_SECRET=CHANGE_ME_JWT_SECRET_HERE

# === DATABASE CONNECTION ===
VIKUNJA_DATABASE_TYPE=postgres
VIKUNJA_DATABASE_HOST=vikunja-db
VIKUNJA_DATABASE_PORT=5432
VIKUNJA_DATABASE_USER=vikunja
VIKUNJA_DATABASE_DATABASE=vikunja

# Connection Pool Configuration
# Tuned for Ryzen 5700U (8 cores) with Foundation stack
VIKUNJA_DATABASE_MAXOPENCONNECTIONS=20
VIKUNJA_DATABASE_MAXIDLECONNECTIONS=5

# === SERVICE CONFIGURATION ===
VIKUNJA_SERVICE_PUBLICURL=http://localhost/vikunja
VIKUNJA_SERVICE_JWTEXPIRATION=86400  # 24 hours

# === REDIS INTEGRATION ===
# CRITICAL: All 3 variables required for Redis to work
#   1. VIKUNJA_REDIS_ENABLED must be "true"
#   2. VIKUNJA_REDIS_HOST must be "redis"
#   3. VIKUNJA_REDIS_PORT must be "6379" (quoted string)
#
# Why separate HOST and PORT?
#   Vikunja expects them as separate variables.
#   Do NOT use: redis:6379 format
#   DO use: HOST=redis, PORT=6379
#
# Database 5:
#   Foundation uses Redis DB 0-4 (cache, sessions)
#   Vikunja uses Redis DB 5 (isolated, no conflict)

VIKUNJA_REDIS_ENABLED=true
VIKUNJA_REDIS_HOST=redis
VIKUNJA_REDIS_PORT=6379  # Port quoted as string, and explicit (not in HOST)
VIKUNJA_REDIS_DB=5       # Isolated from Foundation (0-4)

# Redis password (same as Foundation REDIS_PASSWORD)
# Vikunja will use: VIKUNJA_REDIS_PASSWORD=${REDIS_PASSWORD}
# But you can override if needed:
# VIKUNJA_REDIS_PASSWORD=changeme123

# === FEATURES ===
VIKUNJA_ENABLECALENDAR=true   # Calendar/Gantt chart support
VIKUNJA_ENABLESYNC=false      # Disabled (air-gapped, no external sync)

# === FILES ===
VIKUNJA_FILES_MAXSIZE=20971520  # 20 MB (size in bytes)

# === LOGGING ===
VIKUNJA_LOGGER_LEVEL=info      # Options: debug, info, warn, error
# VIKUNJA_LOGGER_LEVEL=debug   # Uncomment for debugging

# === EMAIL (Disabled for Air-Gap) ===
VIKUNJA_MAILER_ENABLED=false   # No email notifications in air-gapped setup

# === CORS (Security) ===
VIKUNJA_CORS_ENABLE=false      # Disabled (localhost only)

# ============================================================================
# SECURITY NOTES
# ============================================================================
#
# 1. PASSWORDS
#    - VIKUNJA_DB_PASSWORD: Database user password (Vikunja ↔ PostgreSQL)
#    - VIKUNJA_JWT_SECRET: Token signing secret (Vikunja ↔ Client)
#    - REDIS_PASSWORD: Cache authentication (Vikunja ↔ Redis)
#    - Generate with: openssl rand -base64 <bytes>
#    - Store securely, never in version control
#
# 2. .ENV FILE PROTECTION
#    - Add to .gitignore: .env .env.local secrets/
#    - File permissions: chmod 600 .env
#    - Only readable by owner
#
# 3. ENVIRONMENT VARIABLE SAFETY
#    - Only your local shell has these values
#    - docker-compose reads from .env at runtime
#    - Passwords never in Docker images
#    - Passwords never in git history
#
# 4. ROTATION (when needed)
#    - Database password: ALTER USER vikunja WITH PASSWORD '...'
#    - JWT secret: Change VIKUNJA_JWT_SECRET (users re-login)
#    - Redis password: CONFIG SET requirepass '...' (services restart)
#
# ============================================================================

# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================
#
# BEFORE STARTING:
#
# ☐ 1. Paste generated VIKUNJA_DB_PASSWORD above (openssl rand -base64 32)
# ☐ 2. Paste generated VIKUNJA_JWT_SECRET above (openssl rand -base64 64)
# ☐ 3. Verify REDIS_PASSWORD matches Foundation .env
# ☐ 4. Verify .env is in .gitignore (no accidental commits)
# ☐ 5. Verify file permissions: chmod 600 .env
#
# AFTER DEPLOYMENT:
#
# ☐ 6. Test Vikunja API: curl http://localhost:3456/api/v1/info
# ☐ 7. Test login endpoint: curl -X POST http://localhost:3456/api/v1/login
# ☐ 8. Check logs: podman logs xnai_vikunja
# ☐ 9. Verify Redis DB 5: redis-cli -n 5 DBSIZE
# ☐ 10. Test Caddy proxy: curl http://localhost:8000/vikunja/api/v1/info
#
# ============================================================================

# ============================================================================
# EXAMPLE GENERATED PASSWORDS (FOR REFERENCE ONLY)
# ============================================================================
#
# Example VIKUNJA_DB_PASSWORD (32 bytes base64):
#   a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
#
# Example VIKUNJA_JWT_SECRET (64 bytes base64):
#   x1y2z3a4b5c6d7e8f9g0h1i2j3k4l5m6n7o8p9q0r1s2t3u4v5w6x7y8z9a0b1c2d3
#
# Note: These are EXAMPLES ONLY!
# Generate YOUR OWN unique passwords with openssl rand -base64
#
# ============================================================================
